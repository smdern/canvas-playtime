// Generated by CoffeeScript 1.4.0
(function() {
  var Box, Circle, Game, UserInputs,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Box = (function() {

    Box.prototype.defaultOptions = {
      x: 0,
      y: 0,
      width: 10,
      height: 10,
      fillStyle: 'black',
      lineWidth: 5
    };

    function Box(args) {
      this.draw = __bind(this.draw, this);

      var _this = this;
      _.defaults(args, this.defaultOptions);
      _.each(['x', 'y', 'width', 'height', 'fillStyle'], function(option) {
        return _this[option] = args[option];
      });
    }

    Box.prototype.draw = function(context, dx, dy) {
      if (dx == null) {
        dx = 0;
      }
      if (dy == null) {
        dy = 0;
      }
      this.x += dx;
      this.y += dy;
      context.fillStyle = this.fillStyle;
      context.beginPath();
      context.rect(this.x, this.y, this.width, this.height);
      context.closePath();
      return context.fill();
    };

    return Box;

  })();

  Circle = (function() {

    Circle.prototype.defaultOptions = {
      x: 10,
      y: 10,
      radius: 20,
      startAngle: 0,
      endAngle: 2 * Math.PI,
      antiClockwise: true,
      fillStyle: 'black'
    };

    function Circle(args) {
      this.draw = __bind(this.draw, this);

      var _this = this;
      _.defaults(args, this.defaultOptions);
      _.each(['x', 'y', 'radius', 'startAngle', 'endAngle', 'antiClockwise', 'fillStyle'], function(option) {
        return _this[option] = args[option];
      });
    }

    Circle.prototype.draw = function(context, dx, dy) {
      if (dx == null) {
        dx = 0;
      }
      if (dy == null) {
        dy = 0;
      }
      this.x += dx;
      this.y += dy;
      context.fillStyle = this.fillStyle;
      context.lineWidth = 5;
      context.beginPath();
      context.arc(this.x, this.y, this.radius, this.startAngle, this.endAngle, this.antiClockwise);
      context.stroke();
      context.closePath();
      return context.fill();
    };

    return Circle;

  })();

  Game = (function() {

    function Game() {
      this.clear = __bind(this.clear, this);

      this.animate = __bind(this.animate, this);

      this.tick = __bind(this.tick, this);

      this.gameLoop = __bind(this.gameLoop, this);

      this.getUserInput = __bind(this.getUserInput, this);

      this.start = __bind(this.start, this);

      var $canvas;
      $canvas = $('canvas');
      this.context = $canvas[0].getContext('2d');
      this.width = $canvas.width();
      this.height = $canvas.height();
      this.userInput = new UserInputs();
      this.box = new Box({
        x: 100,
        y: 150,
        fillStyle: this.colors.green,
        width: 200
      });
      this.circle = new Circle({
        fillStyle: this.colors.red,
        radius: 20,
        x: 20,
        y: 20
      });
      this.requestAnimationFrame = this.getAnimationRequest();
    }

    Game.prototype.colors = {
      green: "#33A534",
      black: "#000000",
      red: "#FF2600"
    };

    Game.prototype.getAnimationStartTime = function() {
      return window.mozAnimationStartTime || window.msAnimationStartTime || window.webkitAnimationStartTime || window.oAnimationStartTime || Date.now();
    };

    Game.prototype.start = function() {
      this.stepStartTime = this.getAnimationStartTime();
      return setInterval(this.gameLoop, 50);
    };

    Game.prototype.getUserInput = function() {
      return this.userInput.updateCurrentKeys();
    };

    Game.prototype.gameLoop = function() {
      this.getUserInput();
      return this.tick();
    };

    Game.prototype.tick = function() {
      return this.requestAnimationFrame.call(window, this.animate);
    };

    Game.prototype.getAnimationRequest = function() {
      return window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    };

    Game.prototype.animate = function(time) {
      var dyDx;
      this.clear();
      dyDx = this.userInput.getDirection();
      this.box.draw(this.context, dyDx.dx, dyDx.dy);
      return this.circle.draw(this.context, dyDx.dx, dyDx.dy);
    };

    Game.prototype.clear = function() {
      return this.context.clearRect(0, 0, this.width, this.height);
    };

    return Game;

  })();

  $(document).ready(function() {
    var PlayTime;
    PlayTime = {};
    PlayTime.game = new Game();
    return PlayTime.game.start();
  });

  UserInputs = (function() {

    function UserInputs() {
      this.getDirection = __bind(this.getDirection, this);

      this.updateCurrentKeys = __bind(this.updateCurrentKeys, this);

    }

    UserInputs.prototype.previousKeys = [];

    UserInputs.prototype.currentKeys = [];

    UserInputs.prototype.updateCurrentKeys = function() {
      this.previousKeys = this.currentKeys;
      return this.currentKeys = key.getPressedKeyCodes();
    };

    UserInputs.prototype.getDirection = function() {
      var dx, dy, moveFactor,
        _this = this;
      dy = 0;
      dx = 0;
      moveFactor = 5;
      console.log('current keys', this.currentKeys);
      _.each(this.currentKeys, function(key) {
        switch (key) {
          case 37:
            return dx -= moveFactor;
          case 38:
            return dy -= moveFactor;
          case 39:
            return dx += moveFactor;
          case 40:
            return dy += moveFactor;
        }
      });
      return {
        dx: dx,
        dy: dy
      };
    };

    return UserInputs;

  })();

}).call(this);
